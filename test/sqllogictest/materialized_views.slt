# Copyright Materialize, Inc. and contributors. All rights resemved.
#
# Use of this software is governed by the Business Source License
# included in the LICENSE file at the root of this repository.
#
# As of the Change Date specified in that file, in accordance with
# the Business Source License, use of this software will be governed
# by the Apache License, Version 2.0.

mode cockroach

# Setup

statement ok
CREATE TABLE t2 (x int, y int, z int);

statement ok
INSERT INTO t2 VALUES (NULL, 2, 3), (4, NULL, 6), (7, 8, NULL);

statement ok
UPDATE t2 SET x=1 WHERE x IS NULL;

# ------------------------------------------------------------------
# REFRESH options (see also in materialized-view-refresh-options.td)
# ------------------------------------------------------------------

simple conn=mz_system,user=mz_system
ALTER SYSTEM SET enable_refresh_every_mvs = true
----
COMPLETE 0

statement ok
CREATE MATERIALIZED VIEW mv3
WITH (REFRESH AT mz_now()::text::int8 + 2000, REFRESH AT mz_now()::text::int8 + 4000)
AS SELECT * FROM t2;

statement ok
SELECT * FROM mv3;

statement ok
SELECT * FROM mv3;

statement ok
INSERT INTO t2 VALUES (70, 70, 70);

statement ok
SELECT * FROM mv3;

#query IT
#select * from mz_internal.mz_dataflows;
#----


statement ok
select mz_unsafe.mz_sleep(3);
